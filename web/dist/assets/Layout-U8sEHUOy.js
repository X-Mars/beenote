import{_ as J}from"./logo-FnfcyM4Z.js";import{d as O,m as Q,g as W,r as X,p as Y,f,o as s,c as k,e as a,w as e,F as C,q as A,s as h,t as te,j as S,v as g,_ as Z,u as ae,x as ne,y as oe,b as _,h as x,z,A as T}from"./index-B1xyQZS1.js";import{g as le}from"./index-BzLWzpi_.js";const se={class:"tag-nav"},re=O({__name:"TagNav",setup(P){const b=Q(),N=W(),i=X([]),y=m=>m.path===b.path,u=async m=>{const{path:p,meta:n,params:o,name:c}=m;if(n!=null&&n.title){let w=n.title;if(m.name==="NoteView"&&o.id)try{w=(await le(Number(o.id))).data.title}catch(V){console.error("获取笔记标题失败:",V)}const L={title:w,path:p,params:o,name:c};i.value.some(V=>V.path===p)||i.value.push(L)}},B=m=>{const p=i.value;let n=b.path;n===m&&p.forEach((o,c)=>{if(o.path===m){const w=p[c+1]||p[c-1];w&&(n=w.path)}}),i.value=p.filter(o=>o.path!==m),n&&n!==b.path&&N.push(n)},I=m=>{m.name&&m.params?N.push({name:m.name,params:m.params}):N.push(m.path)};return Y(()=>b.path,async()=>{await u(b)},{immediate:!0}),(m,p)=>{const n=f("el-tag"),o=f("el-scrollbar");return s(),k("div",se,[a(o,{class:"scroll-container"},{default:e(()=>[(s(!0),k(C,null,A(i.value,c=>(s(),h(n,{key:c.path,type:y(c)?"":"info",effect:y(c)?"dark":"plain",class:te({active:y(c)}),round:"",closable:"",onClick:w=>I(c),onClose:w=>B(c.path)},{default:e(()=>[S(g(c.title),1)]),_:2},1032,["type","effect","class","onClick","onClose"]))),128))]),_:1})])}}}),K=Z(re,[["__scopeId","data-v-c9e07263"]]),ue={class:"header-content"},ce={class:"header-right"},de={class:"user-dropdown"},_e={class:"username"},ie={class:"sub-header"},pe={class:"header-right"},me={class:"user-dropdown"},fe={class:"username"},he=O({__name:"Layout",setup(P){const b=Q(),N=W(),i=ae(),y=X(localStorage.getItem("layoutMode")||"horizontal"),u=p=>(p.children||[]).filter(n=>{var o;return!((o=n.meta)!=null&&o.hidden)}),B=ne(()=>N.options.routes.filter(n=>n.path!=="/login"&&n.children).filter(n=>{var o,c;return(o=n.meta)!=null&&o.roles?n.meta.roles.includes(((c=i.user)==null?void 0:c.role)||""):!0}));Y(y,p=>{localStorage.setItem("layoutMode",p)});const I=p=>{p==="logout"?(i.logout(),N.push("/login")):p==="switchLayout"&&(y.value=y.value==="vertical"?"horizontal":"vertical")},m=async()=>{try{await i.initialize()}catch(p){console.error("获取用户信息失败:",p),i.clearUser(),N.push("/login")}};return oe(()=>{i.token&&m()}),(p,n)=>{const o=f("el-icon"),c=f("el-menu-item"),w=f("el-sub-menu"),L=f("el-menu"),V=f("el-avatar"),U=f("ArrowDown"),M=f("el-dropdown-item"),D=f("SwitchButton"),E=f("el-dropdown-menu"),F=f("el-dropdown"),R=f("el-header"),$=f("router-view"),j=f("el-main"),ee=f("el-aside"),q=f("el-container");return s(),h(q,{class:"layout-container"},{default:e(()=>[y.value==="horizontal"?(s(),k(C,{key:0},[a(R,{height:"60px",class:"horizontal-header"},{default:e(()=>[_("div",ue,[n[2]||(n[2]=_("div",{class:"logo horizontal"},[_("img",{src:J,alt:"logo",class:"logo-img"}),_("h1",null,"蜜蜂笔记")],-1)),a(L,{router:!0,"default-active":x(b).path,mode:"horizontal",class:"horizontal-menu"},{default:e(()=>[(s(!0),k(C,null,A(B.value,t=>(s(),k(C,{key:t.path},[u(t).length>1?(s(),h(w,{key:0,index:t.path},{title:e(()=>{var l;return[a(o,null,{default:e(()=>{var r,d;return[(r=t.meta)!=null&&r.icon?(s(),h(z((d=t.meta)==null?void 0:d.icon),{key:0})):T("",!0)]}),_:2},1024),_("span",null,g((l=t.meta)==null?void 0:l.title),1)]}),default:e(()=>[(s(!0),k(C,null,A(u(t),l=>(s(),h(c,{key:l.path,index:l.path},{default:e(()=>{var r;return[a(o,null,{default:e(()=>{var d,v;return[(d=l.meta)!=null&&d.icon?(s(),h(z((v=l.meta)==null?void 0:v.icon),{key:0})):T("",!0)]}),_:2},1024),_("span",null,g((r=l.meta)==null?void 0:r.title),1)]}),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):(s(),h(c,{key:1,index:u(t).length===1?u(t)[0].path:t.path},{default:e(()=>{var l,r;return[a(o,null,{default:e(()=>{var d,v,G,H;return[(u(t).length===1?(d=u(t)[0].meta)!=null&&d.icon:(v=t.meta)!=null&&v.icon)?(s(),h(z(u(t).length===1?(G=u(t)[0].meta)==null?void 0:G.icon:(H=t.meta)==null?void 0:H.icon),{key:0})):T("",!0)]}),_:2},1024),_("span",null,g(u(t).length===1?(l=u(t)[0].meta)==null?void 0:l.title:(r=t.meta)==null?void 0:r.title),1)]}),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active"]),_("div",ce,[a(F,{onCommand:I},{dropdown:e(()=>[a(E,null,{default:e(()=>[a(M,{command:"switchLayout"},{default:e(()=>[a(o,null,{default:e(()=>[(s(),h(z(y.value==="horizontal"?"Expand":"Fold")))]),_:1}),n[0]||(n[0]=S(" 切换布局 "))]),_:1}),a(M,{command:"logout"},{default:e(()=>[a(o,null,{default:e(()=>[a(D)]),_:1}),n[1]||(n[1]=S(" 退出登录 "))]),_:1})]),_:1})]),default:e(()=>{var t,l;return[_("span",de,[a(V,{size:32,class:"avatar"},{default:e(()=>{var r,d,v;return[S(g((v=((r=x(i).user)==null?void 0:r.name)||((d=x(i).user)==null?void 0:d.username))==null?void 0:v.charAt(0).toUpperCase()),1)]}),_:1}),_("span",_e,g(((t=x(i).user)==null?void 0:t.name)||((l=x(i).user)==null?void 0:l.username)),1),a(o,null,{default:e(()=>[a(U)]),_:1})])]}),_:1})])])]),_:1}),_("div",ie,[a(K)]),a(j,null,{default:e(()=>[a($)]),_:1})],64)):(s(),k(C,{key:1},[a(ee,{width:"200px"},{default:e(()=>[n[3]||(n[3]=_("div",{class:"logo"},[_("img",{src:J,alt:"logo",class:"logo-img"}),_("h1",null,"蜜蜂笔记")],-1)),a(L,{router:!0,"default-active":x(b).path,class:"menu"},{default:e(()=>[(s(!0),k(C,null,A(B.value,t=>(s(),k(C,{key:t.path},[u(t).length>1?(s(),h(w,{key:0,index:t.path},{title:e(()=>{var l;return[a(o,null,{default:e(()=>{var r;return[(s(),h(z((r=t.meta)==null?void 0:r.icon)))]}),_:2},1024),_("span",null,g((l=t.meta)==null?void 0:l.title),1)]}),default:e(()=>[(s(!0),k(C,null,A(u(t),l=>(s(),h(c,{key:l.path,index:l.path},{default:e(()=>{var r;return[a(o,null,{default:e(()=>{var d;return[(s(),h(z((d=l.meta)==null?void 0:d.icon)))]}),_:2},1024),_("span",null,g((r=l.meta)==null?void 0:r.title),1)]}),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):(s(),h(c,{key:1,index:u(t).length===1?u(t)[0].path:t.path},{default:e(()=>{var l,r;return[a(o,null,{default:e(()=>{var d,v;return[(s(),h(z(u(t).length===1?(d=u(t)[0].meta)==null?void 0:d.icon:(v=t.meta)==null?void 0:v.icon)))]}),_:2},1024),_("span",null,g(u(t).length===1?(l=u(t)[0].meta)==null?void 0:l.title:(r=t.meta)==null?void 0:r.title),1)]}),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active"])]),_:1}),a(q,null,{default:e(()=>[a(R,null,{default:e(()=>[_("div",pe,[a(F,{onCommand:I},{dropdown:e(()=>[a(E,null,{default:e(()=>[a(M,{command:"switchLayout"},{default:e(()=>[a(o,null,{default:e(()=>[(s(),h(z(y.value==="vertical"?"Fold":"Expand")))]),_:1}),n[4]||(n[4]=S(" 切换布局 "))]),_:1}),a(M,{command:"logout"},{default:e(()=>[a(o,null,{default:e(()=>[a(D)]),_:1}),n[5]||(n[5]=S(" 退出登录 "))]),_:1})]),_:1})]),default:e(()=>{var t,l;return[_("span",me,[a(V,{size:32,class:"avatar"},{default:e(()=>{var r,d,v;return[S(g((v=((r=x(i).user)==null?void 0:r.name)||((d=x(i).user)==null?void 0:d.username))==null?void 0:v.charAt(0).toUpperCase()),1)]}),_:1}),_("span",fe,g(((t=x(i).user)==null?void 0:t.name)||((l=x(i).user)==null?void 0:l.username)),1),a(o,null,{default:e(()=>[a(U)]),_:1})])]}),_:1})]),a(K)]),_:1}),a(j,null,{default:e(()=>[a($)]),_:1})]),_:1})],64))]),_:1})}}}),we=Z(he,[["__scopeId","data-v-c9bca0e3"]]);export{we as default};
